{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}PostgreSQL Dashboard{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Trang chá»§' %}</a>
    &rsaquo; PostgreSQL Dashboard
</div>
{% endblock %}

{% block content %}
<style>
.schema-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 16px; }
.stat-card { display: flex; align-items: center; gap: 10px; padding: 14px 16px; background: #fff; border-radius: 8px; border: 1px solid var(--hairline-color, #ccc); }
.stat-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.stat-value { font-size: 20px; font-weight: 700; line-height: 1.2; }
.stat-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
.action-bar a { display: inline-flex; align-items: center; gap: 6px; padding: 10px 18px; border-radius: 6px; text-decoration: none; font-size: 13px; font-weight: 600; color: #fff !important; margin-right: 6px; margin-bottom: 6px; }
</style>

<!-- Connection Status -->
{% if connection_status == 'connected' %}

<!-- Stats Cards -->
<div class="schema-stats">
    <div class="stat-card">
        <div class="stat-icon" style="background:#d1fae5;">âœ…</div>
        <div><div class="stat-value" style="color:#059669;">Online</div><div class="stat-label">Status</div></div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background:#dbeafe;">ğŸ—„ï¸</div>
        <div><div class="stat-value">{{ table_count }}</div><div class="stat-label">Tables</div></div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background:#fef3c7;">ğŸ’¾</div>
        <div><div class="stat-value">{{ db_size }}</div><div class="stat-label">Size</div></div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background:#e0e7ff;">ğŸ”Œ</div>
        <div><div class="stat-value">{{ active_connections }}</div><div class="stat-label">Connections</div></div>
    </div>
</div>

<!-- Connection Info -->
<div class="module">
    <h2>ğŸ”— Káº¿t ná»‘i</h2>
    <table>
        <tbody>
            <tr><th scope="row">Database:</th><td><code>{{ db_name }}</code></td></tr>
            <tr><th scope="row">User:</th><td><code>{{ db_user }}</code></td></tr>
            <tr><th scope="row">Host:</th><td><code>{{ db_host }}:{{ db_port }}</code></td></tr>
            <tr><th scope="row">Version:</th><td style="font-size:12px;">{{ db_version|truncatechars:80 }}</td></tr>
        </tbody>
    </table>
</div>

<!-- Quick Actions -->
<div class="module">
    <h2>ğŸ”§ CÃ´ng cá»¥</h2>
    <div style="padding:14px;display:flex;flex-wrap:wrap;">
        <a href="/admin/postgres/tables/" class="action-bar" style="background:var(--primary,#5D5A2F);display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;margin-right:6px;">ğŸ“Š Browse Tables</a>
        <a href="/admin/postgres/export-schema/?format=json" class="action-bar" style="background:#059669;display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;margin-right:6px;">ğŸ“¥ Export Schema</a>
        <a href="/admin/postgres/backup/" class="action-bar" style="background:#6366f1;display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;margin-right:6px;">ğŸ’¾ Backup</a>
        <a href="/admin/postgres/test-connection/" class="action-bar" style="background:#d97706;display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;margin-right:6px;">ğŸ”Œ Test Connection</a>
        <a href="/admin/postgres/generate-password/" class="action-bar" style="background:#dc2626;display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;">ğŸ” Generate Password</a>
    </div>
</div>

<!-- Tables -->
{% if tables %}
<div class="module">
    <h2>ğŸ“Š Tables ({{ table_count }})</h2>
    <table id="result_list" style="width:100%;">
        <thead><tr><th>#</th><th>Table Name</th><th style="text-align:right;">Rows</th><th style="text-align:right;">Size</th></tr></thead>
        <tbody>
            {% for table in tables %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td style="color:#999;">{{ forloop.counter }}</td>
                <td><a href="/admin/postgres/tables/{{ table.name }}/"><strong>{{ table.name }}</strong></a></td>
                <td style="text-align:right;">{{ table.rows|default:"-" }}</td>
                <td style="text-align:right;">{{ table.size|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% else %}
<!-- Error State -->
<div class="module">
    <h2>âŒ Lá»—i káº¿t ná»‘i</h2>
    <p style="color:#dc2626;padding:14px;">{{ error_message }}</p>
    <div style="padding:0 14px 14px;">
        <a href="/admin/postgres/test-connection/" style="display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:600;color:#fff !important;background:#d97706;">ğŸ”Œ Test Connection</a>
    </div>
</div>
{% endif %}
{% endblock %}